<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <!-- Vista de Filtros para Licitaciones  -->
  <record id="view_crm_case_tenders_filter" model="ir.ui.view">
    <field name="name">crm.lead.search.tender</field>
    <field name="model">crm.lead</field>
    <field name="priority">15</field>
    <field name="arch" type="xml">
      <search string="Search Tenders">
        <field name="name" string="Tender" filter_domain="['|','|','|',('partner_id','ilike',self),('partner_name','ilike',self),('email_from','ilike',self),('name', 'ilike', self)]"/>
        <field name="tag_ids" string="Tag" filter_domain="[('tag_ids', 'ilike', self)]"/>
        <field name="stage_id" domain="[]"/>
        <field name="user_id"/>
        <field name="team_id"/>
        <field name="partner_id" operator="child_of" string="Customer"/>
        <field name="city"/>
        <field name="country_id"/>
        <field name="activity_type_id"/>
        <field name="activity_summary"/>
        <field name="probability"/>
        <field name="lost_reason"/>
        <field name="date_conversion"/>
        <separator/>
        <filter string="My Tender" name="assigned_to_me" domain="[('user_id', '=', uid)]" help="Tenders that are assigned to me"/>
        <filter string="Unassigned" name="unassigned" domain="[('user_id','=', False)]" help="No salesperson"/>
        <filter string="Open Tenders" name="open_tenders" domain="[('probability', '&lt;', 100), ('tender', '=', True)]" help="Open Tenders"/>
        <separator/>
        <filter string="Unread Messages" name="message_needaction" domain="[('message_needaction','=',True)]"/>
        <separator/>
        <filter string="Overdue Tenders" name="overdue_tender" domain="[('date_deadline', '&lt;', context_today().strftime('%Y-%m-%d')), ('date_closed', '=', False)]" help="Tneders with a date of Expected Closing which is in the past"/>
        <filter string="Creation Date" name="creation_date" date="create_date"/>
        <filter string="Expected Closing" name="close_this_month" date="date_deadline"/>
        <filter string="Closed Date" name="close_date" date="date_closed"/>
        <separator/>
        <filter string="Won" name="won" domain="['&amp;', ('active', '=', True), ('stage_id.probability', '=', 100)]"/>
        <filter string="Lost" name="lost" domain="['&amp;', ('active', '=', False), ('probability', '=', 0)]"/>
        <separator/>
        <filter string="Activities Todo" name="activities_my" domain="[('activity_ids.user_id', '=', uid)]"/>
        <separator/>
        <filter string="Late Activities" name="activities_overdue" domain="[('activity_ids.date_deadline', '&lt;', context_today().strftime('%Y-%m-%d'))]" help="Show all Tenders for which the next action date is before today"/>
        <filter string="Today Activities" name="activities_today" domain="[('activity_ids.date_deadline', '=', context_today().strftime('%Y-%m-%d'))]"/>
        <filter string="Future Activities" name="activities_upcoming_all" domain="[('activity_ids.date_deadline', '&gt;', context_today().strftime('%Y-%m-%d'))]"/>
        <group expand="0" string="Group By" colspan="16">
        <filter string="Salesperson" name="salesperson" context="{'group_by':'user_id'}"/>
        <filter string="Sales Team" name="saleschannel" context="{'group_by':'team_id'}"/>
        <filter name="stage" string="Stage" context="{'group_by':'stage_id'}"/>
        <filter name="city" string="City" context="{'group_by': 'city'}"/>
        <filter string="Country" name="country" context="{'group_by':'country_id'}" />
        <filter string="Lost Reason" name="lostreason" context="{'group_by':'lost_reason'}"/>
        <filter string="Company" name="company" context="{'group_by':'company_id'}" groups="base.group_multi_company"/>
        <filter string="Campaign" name="compaign" domain="[]" context="{'group_by':'campaign_id'}"/>
        <filter string="Medium" name="medium" domain="[]" context="{'group_by':'medium_id'}"/>
        <filter string="Source" name="source" domain="[]" context="{'group_by':'source_id'}"/>
        <separator orientation="vertical" />
        <filter string="Creation Date" context="{'group_by':'create_date:month'}" name="month"/>
        <filter string="Conversion Date" name="date_conversion" context="{'group_by': 'date_conversion'}" groups="crm.group_use_lead"/>
        <filter string="Closed Date" name="date_closed" context="{'group_by':'date_closed'}"/>
        <filter string="Expected Closing Date" name="date_deadline" context="{'group_by':'date_deadline'}"/>
        </group>
      </search>
    </field>
  </record>

<!-- Action de Menu Licitaciones  -->
  <record id="action_tender_form" model="ir.actions.act_window">
    <field name="name">Tenders</field>
    <field name="type">ir.actions.act_window</field>
    <field name="res_model">crm.lead</field>
    <field name="view_type">form</field>
    <field name="view_mode">kanban,tree,form</field>
    <field name="domain">[('tender','=', True)]</field>
    <field name="context">{"search_default_tender":1}</field>
    <field name="search_view_id" ref="view_crm_case_tenders_filter"/>
    <field name="help" type="html">
      <p class="o_view_nocontent_smiling_face">
       Create a new Tender in your CRM
      </p>
      <p>
       Odoo helps you easily track all activities related to a customer.
      </p>
    </field>
  </record>

<!-- Menu de Licitaciones  -->
  <menuitem
    id="tender_menu_crm"
    name="Tenders"
    parent="crm.crm_menu_sales"
    action="action_tender_form"
    sequence="2"/>

<!-- Vista de Formulario para Licitaciones  -->
  <record id="crm_lead_tender_view_form" model="ir.ui.view">
    <field name="name">Crm Lead - Tender Form</field>
    <field name="model">crm.lead</field>
    <field name="inherit_id" ref="crm.crm_case_form_view_oppor" />
    <field name="arch" type="xml">
      <xpath expr="//field[@name='partner_id']" position="before">
        <field name="tender" string="Is Tender"/>
      </xpath>
      <xpath expr="//notebook" position="inside">
        <page string="Tender">
          <group>
            <field name="tender_line">
              <tree string="Tender Lines" editable="bottom">
                <field name="line"/>
                <field name="participation"/>
                <field name="name"/>
                <field name="technical_file_id"/>
                <field name="model_id"/>
                <field name="product_id"/>
                <field name="product_uom_qty"/>
                <field name="product_uom"/>
                <field name="price_unit"/>
                <field name="price_subtotal"/>
              </tree>
            </field>
          </group>
        </page>
      </xpath>
    </field>
  </record>

</odoo>
